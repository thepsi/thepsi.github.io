(this.webpackJsonpbluetemp=this.webpackJsonpbluetemp||[]).push([[0],{186:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(19),c=n.n(i),o=(n(88),n(18)),s=(n(89),n(21)),u=n.n(s),l=n(36),h=n(215),d=["Base station","Channel 1","Channel 2","Channel 3","Channel 4","Channel 5"],f=function(e,t){var n=e.getInt16(t,!0);return 32767===n?null:n/10},m=function(e,t){var n=e.getUint8(t);return 127===n?null:n};function p(e,t,n){return{name:e,temperature:t,humidity:n}}function g(){var e=this;this.gatt_=null,this.characteristics_={},this.dataHandler_=null,this.currentReadingPromises_=[],this.currentReadingResolves_=[];for(var t=0;t<d.length;t++)this.currentReadingPromises_.push(new Promise((function(t,n){e.currentReadingResolves_.push(t)})));this.readyForCommandsPromise_=new Promise((function(t,n){e.readyForCommandsResolve_=t}))}g.prototype.handleCharacteristicChanged_=function(e){var t=e.target,n=t.value;if("74e78e10-c6a4-11e2-b7a9-0002a5d5c51b"===t.uuid)1===n.getUint8(0)&&(this.currentReadingResolves_[0](p(d[0],f(n,1),m(n,9))),this.currentReadingResolves_[1](p(d[1],f(n,3),m(n,10))),this.currentReadingResolves_[2](p(d[2],f(n,5),m(n,11))),this.currentReadingResolves_[3](p(d[3],f(n,7),m(n,12))));else if("74e78e14-c6a4-11e2-b7a9-0002a5d5c51b"===t.uuid){1===n.getUint8(0)&&(this.currentReadingResolves_[4](p(d[4],f(n,1),m(n,9))),this.currentReadingResolves_[5](p(d[5],f(n,3),m(n,10))))}else if("74e78e20-c6a4-11e2-b7a9-0002a5d5c51b"===t.uuid)console.log("Device is ready for commands"),this.readyForCommandsResolve_();else if("74e78e04-c6a4-11e2-b7a9-0002a5d5c51b"===t.uuid){if(null===this.dataHandler_)return;var a=1-n.getUint8(1);this.dataHandler_({hourOffset:a,temperature:f(n,2)}),this.dataHandler_({hourOffset:a-1,temperature:f(n,5)}),this.dataHandler_({hourOffset:a-2,temperature:f(n,8)}),this.dataHandler_({hourOffset:a-3,temperature:f(n,11)}),this.dataHandler_({hourOffset:a-4,temperature:f(n,14)})}},g.prototype.connect=function(){var e=this,t={filters:[{services:["74e7fe00-c6a4-11e2-b7a9-0002a5d5c51b"]}],optionalServices:["battery_service"]};return navigator.bluetooth.requestDevice(t).then((function(e){return e.gatt.connect()})).then((function(t){e.gatt_=t;var n=e.gatt_.getPrimaryService("battery_service").then((function(e){return e.getCharacteristic("battery_level")})).then((function(e){return e.startNotifications()})).then((function(t){return t.addEventListener("characteristicvaluechanged",(function(t){return e.handleCharacteristicChanged_(t)}))})),a=e.gatt_.getPrimaryService("74e7fe00-c6a4-11e2-b7a9-0002a5d5c51b").then((function(e){return e.getCharacteristics()})).then((function(t){var n=[];return t.forEach((function(t){(t.properties.indicate||t.properties.notify)&&(e.characteristics_[t.uuid]=t,n.push(t.startNotifications().then((function(t){return t.addEventListener("characteristicvaluechanged",(function(t){return e.handleCharacteristicChanged_(t)}))}))))})),Promise.all(n)}));return Promise.all([n,a])}))},g.prototype.fetchCurrentReadings=function(){return Promise.all(this.currentReadingPromises_)},g.prototype.fetchHistory=function(e){var t=this,n=null,a=new Promise((function(e,t){n=e})),r=[];return this.dataHandler_=function(e){r.push(e),r.length>=170&&n()},this.readyForCommandsPromise_.then((function(){console.log("Requesting history for channel:",e),e>0&&(e+=15);var n=Int8Array.of(-127,e,-1);return t.characteristics_["74e78e03-c6a4-11e2-b7a9-0002a5d5c51b"].writeValue(n)})).then((function(){return Promise.race([a,(e=1e4,new Promise((function(t,n){var a=setTimeout((function(){clearTimeout(a),n("Timed out in "+e+"ms")}),e)})))]);var e})).catch((function(e){return console.log("Failed:",e,"; got",r.length,"of the expected",170,"points")})).then((function(){return t.dataHandler_=null,r}))},g.prototype.disconnect=function(){this.characteristics_={},this.gatt_.disconnect(),this.gatt_=null};var v=n(207),b=n(214),E=n(209),y=n(213),_=n(212),C=n(208),R=n(210),w=n(211),x=n(188),P=Object(v.a)({table:{minWidth:650}});function O(e,t,n){return{sensor:e,temperature:t,humidity:n}}function H(e){var t=P();return r.a.createElement(C.a,{component:x.a},r.a.createElement(E.a,{className:t.table,"aria-label":"simple table"},r.a.createElement(R.a,null,r.a.createElement(w.a,null,r.a.createElement(_.a,null,"Sensor"),r.a.createElement(_.a,{align:"right"},"Temperature (C)"),r.a.createElement(_.a,{align:"right"},"Humidity (%)"))),r.a.createElement(y.a,null,e.rows.map((function(e){return r.a.createElement(w.a,{key:e.sensor},r.a.createElement(_.a,{component:"th",scope:"row"},e.sensor),r.a.createElement(_.a,{align:"right"},"spin"===e.temperature?r.a.createElement(b.a,null):e.temperature),r.a.createElement(_.a,{align:"right"},"spin"===e.humidity?r.a.createElement(b.a,null):e.humidity))})))))}function k(){return(k=Object(l.a)(u.a.mark((function e(){var t,n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new g,e.next=3,t.connect();case 3:return e.next=5,t.fetchCurrentReadings();case 5:return n=e.sent,a=[],n.forEach((function(e){a.push(O(e.name,e.temperature,e.humidity))})),t.disconnect(),e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){var e=r.a.useState([O("No data yet",null,null)]),t=Object(o.a)(e,2),n=t[0],a=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,{variant:"contained",onClick:function(e){a([O("Loading...","spin","spin")]),function(){return k.apply(this,arguments)}().then((function(e){a(e)})).catch((function(e){a([O("Error: "+e,null,null)])}))}},"Fetch current readings"),r.a.createElement(H,{rows:n}))}var S=n(51),j=n.n(S),N=n(74);function I(){return(I=Object(l.a)(u.a.mark((function e(t,n){var a,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new g,t("Connecting to device"),e.next=4,a.connect();case 4:r=0;case 5:if(!(r<d.length)){e.next=14;break}return t("Fetching data for sensor: "+d[r]),e.next=9,a.fetchHistory(r);case 9:i=e.sent,n(d[r],i);case 11:r++,e.next=5;break;case 14:t("Disconnecting"),a.disconnect();case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],U=["#700e0f","#1b3e59","#285926","#4c2752","#803e00","#80801a"];function A(e){var t=r.a.useState(""),n=Object(o.a)(t,2),a=n[0],i=n[1],c=r.a.useState({datasets:[]}),s=Object(o.a)(c,2),u=s[0],l=s[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,{variant:"contained",onClick:function(e){i("Initialising client library");var t=[];l({datasets:t});var n=j()();(function(e,t){return I.apply(this,arguments)})(i,(function(e,a){var r=[];a.forEach((function(e){r.push({x:n.clone().add(e.hourOffset,"hours").startOf("hour"),y:e.temperature})})),t.push({label:e,data:r,fill:!1,pointRadius:2,borderColor:T[t.length%T.length],backgroundColor:U[t.length%T.length],spanGaps:!1}),l({datasets:t})})).then((function(){i("")}))}},"Fetch last 7 days"),a&&r.a.createElement("div",null,r.a.createElement(b.a,null),a),r.a.createElement(N.a,{options:{scales:{xAxes:[{type:"time",time:{unit:"day"}}]}},data:u}))}var B=n(216),D=n(220),L=n(218),W=n(221),q=n(219),J=n(217);function G(e){var t=e.children,n=e.value,a=e.index;return r.a.createElement(B.a,{component:"div",role:"tabpanel",hidden:n!==a},n===a&&r.a.createElement(D.a,null,t))}var M=function(){var e=r.a.useState(0),t=Object(o.a)(e,2),n=t[0],a=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(J.a,null),r.a.createElement("div",{className:"App"},r.a.createElement(L.a,{position:"static"},r.a.createElement(W.a,{value:n,onChange:function(e,t){a(t)}},r.a.createElement(q.a,{label:"Current"}),r.a.createElement(q.a,{label:"History"}))),r.a.createElement(G,{value:n,index:0},r.a.createElement(F,null)),r.a.createElement(G,{value:n,index:1},r.a.createElement(A,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},83:function(e,t,n){e.exports=n(186)},88:function(e,t,n){},89:function(e,t,n){}},[[83,1,2]]]);
//# sourceMappingURL=main.c5bf7fd2.chunk.js.map